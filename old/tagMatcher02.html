
<script>
  //                         1111111111222
  //               01234567890123456789012
  var testString = "<tr id='smith'><td>trala</td></tr>"
  var formattedString = '';
  var insideTag = false;
  var inOpenTag = false;
  var inCloseTag = false;
  var grammarStack = [];
  // status 
  // inside an opening tag inOpenTag
  // inside a closing tag  inCloseTag
  // inbetween openning and closing tags betweenTags
  
  var curPos= 0;
  // 
  for (var i=0; i < testString.length; i++) {
    // console.log("at start, i is "+i)
    if (testString[i] == '<') {
      // returnVal is a 2 element vector.  the first is a gramatical unit 
      // and the second is the position in the string being parsed
      var returnVal = buildTag(testString, i);     
    } else {
      var returnVal = buildString(testString, i);      
    }
    //add some error checking code here
    // console.log(returnVal);
    grammarStack.push(returnVal[0]);
    i = returnVal[1]
    console.log("at end, i is "+i)
  }

  console.log(grammarStack);

  function buildTag(inString, position) {
    // console.log("in build tag")
    var returnTag = inString[position];
    // console.log("returnTag is now "+returnTag)    

    if (inString[position] != '<') {
        console.log("ERROR buildTag called incorrectly");
        return [-1, -1];
    }

    var j = position+1;

    do {
      if (j == inString.length) {
        console.log("ERROR closing '>' not found")
        return [-1, -1]
      }
      returnTag += inString[j];
      j++;
    } while (inString[j-1] != '>'); 

    // console.log(returnTag, j)

    return [returnTag, j-1]

  }


  function buildString(inString, position) {
    // var returnTag = '';
    console.log("in build string")
    var j = position+1;

    if (inString[position] == '<') {
        console.log("ERROR buildString called incorrectly");
        return [-1, -1];
    }
    var returnString = inString[position];

    while (j < inString.length && inString[j] != '<') {
      console.log(j, returnString)
      returnString += inString[j];
      j++;
    }
    console.log(returnString, j)
    // if (inString[j] == '<') {
      return [returnString, j-1]
    // } else if (j == inString.length) {
    // return [returnTag, -j]
    // }
  }




</script>